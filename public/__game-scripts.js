const ZapparCamera=pc.createScript("zapparCamera");ZapparCamera.attributes.add("Front Facing Camera",{type:"boolean",default:!1,description:"Should front camera be used"}),ZapparCamera.attributes.add("Mirror Mode",{type:"string",enum:[{None:"none"},{CSS:"css"},{Poses:"poses"}],default:"none",description:"How the scene and camera is mirrored/flipped"}),ZapparCamera.attributes.add("Camera Pose",{type:"string",enum:[{Default:"default"},{Anchor:"anchor"},{Attitude:"attitude"}],default:"default",description:"Pose mode of the tracked content"}),ZapparCamera.prototype.initialize=function(){if(this.canvas=this.app.graphicsDevice.canvas,this.gl=this.canvas.getContext("webgl2")||this.canvas.getContext("webgl"),!this.gl)throw new Error("no gl");this.cameraPoseMatrix=new pc.Mat4,this.mirror=!1,ZapparCamera.prototype.pipeline=new Zappar.Pipeline,this.pipeline.glContextSet(this.gl);const getActiveSource=()=>this["Front Facing Camera"]?ZapparCamera.prototype.source.user:ZapparCamera.prototype.source.rear;this.app.on("zappar:camera",(e=>{const{message:a,userFacing:t}=e;"flip"===a&&(void 0===t?(this["Front Facing Camera"]=!this["Front Facing Camera"],getActiveSource().start()):(this["Front Facing Camera"]=t,getActiveSource().start()))})),ZapparCamera.prototype.source={user:new Zappar.CameraSource(this.pipeline,Zappar.cameraDefaultDeviceID(!0)),rear:new Zappar.CameraSource(this.pipeline,Zappar.cameraDefaultDeviceID(!1))},Zappar.permissionRequestUI().then((e=>{this.app.fire("zappar:camera",{message:"permission_granted",granted:e}),e?getActiveSource().start():Zappar.permissionDeniedUI()})),document.addEventListener("visibilitychange",(()=>{const e=getActiveSource();if("hidden"===document.visibilityState)e.pause();else e.start()})),this.initializeBackground()},ZapparCamera.prototype.update=function(){if(!this.pipeline||!this.app.autoRender)return;this.pipeline.frameUpdate();const e=Array.from(this.pipeline.cameraPoseDefault());this.cameraPoseMatrix.set(e);const{width:a,height:t}=this.canvas;switch(this["Mirror Mode"]){case"none":this.mirror=!1,this.canvas.style.transform="";break;case"poses":this.mirror=!0,this.canvas.style.transform="";break;case"css":this.mirror=!1,this.canvas.style.transform="scaleX(-1)";break;default:throw new Error("Unknown mirror type")}this.pipeline.processGL(),this.pipeline.frameUpdate();const r=this.pipeline.cameraModel(),i=Array.from(Zappar.projectionMatrixFromCameraModel(r,a,t)),n=(new pc.Mat4).set(i),s=this.entity.camera;s&&(s.calculateProjection=e=>{e.copy(n);const a=n.data;s.horizontalFov=!1,s.fov=2*Math.atan(1/a[5])*180/Math.PI,s.aspectRatio=a[5]/a[0],s.farClip=a[14]/(a[10]+1),s.nearClip=a[14]/(a[10]-1)},this.updateBackgroundTexture(this.pipeline))},ZapparCamera.prototype.initializeBackground=function(){this.backgroundPlane=new pc.Entity,this.backgroundPlane.addComponent("render",{type:"plane"}),this.backgroundPlane.setLocalEulerAngles(-90,0,0),this.entity.addChild(this.backgroundPlane),this.texture=new pc.Texture(this.app.graphicsDevice,{format:pc.PIXELFORMAT_R8_G8_B8}),this.material=new pc.Material,this.material.cull=pc.CULLFACE_FRONT,this.backgroundPlane.render.material=this.material;const e={attributes:{position:pc.SEMANTIC_POSITION,texcoord:pc.SEMANTIC_TEXCOORD0},vshader:"\n            precision highp float;\n            attribute vec3 position;\n            attribute vec2 texcoord;\n            uniform mat4 texTransform;\n\n            uniform mat4 matrix_model;\n            uniform mat4 matrix_viewProjection;\n\n            varying vec2 uv;\n\n            void main(void)\n            {\n                uv = (texTransform * vec4(texcoord.xy, 0., 1.)).xy;\n\n                gl_Position = matrix_viewProjection * matrix_model * vec4(position, 1.0);\n            }",fshader:"\n            precision highp float;\n            varying vec2 uv;\n            uniform sampler2D uCameraTexture;\n\n            void main(void)\n            {\n                vec4 color = texture2D(uCameraTexture, uv);\n                gl_FragColor = color;\n            }"},a=new pc.Shader(this.app.graphicsDevice,e);this.material.shader=a,this.material.setParameter("uCameraTexture",this.texture)},ZapparCamera.prototype.updateBackgroundTexture=function(e){const{aspectRatio:a,fov:t,farClip:r}=this.entity.camera;this.backgroundPlane.setPosition(0,0,-(r-Number.MIN_VALUE));const i=this.backgroundPlane.getPosition().length(),n=t*Math.PI/180,s=i*Math.tan(n/2)*2,o=s*a;this.backgroundPlane.setLocalScale(o,1,s),this.texture.impl&&this.texture.impl._glTexture?this.texture.impl._glTexture=e.cameraFrameTextureGL():this.texture._glTexture=e.cameraFrameTextureGL();const p=e.cameraFrameTextureMatrix(this.app.graphicsDevice.width,this.app.graphicsDevice.height,this.mirror);this.material.setParameter("texTransform",p)};const zapparImageTracker=pc.createScript("zapparImageTracker");zapparImageTracker.attributes.add("Target Image",{type:"asset",assetType:"binary",description:"Image Target file (.zpt) "}),zapparImageTracker.attributes.add("Target Upright",{type:"boolean",default:!0,description:"Offset rotations for upright targets"}),zapparImageTracker.attributes.add("Zappar Camera",{type:"entity",description:"Zappar Camera (Drag from hierarchy)"}),zapparImageTracker.prototype.initialize=function(){if(!this["Zappar Camera"])throw new Error("Zappar Camera attribute undefined - Please link camera entity to attribute.");if(this.Camera=this["Zappar Camera"].script.zapparCamera,this.pipeline=this.Camera.pipeline,this.imageTracker=new Zappar.ImageTracker(this.pipeline),this.imageTracker.onNewAnchor.bind((a=>{console.log("New anchor has appeared:",a.id)})),this.imageTracker.onVisible.bind((a=>{this.app.fire("zappar:visible",!0)})),this.imageTracker.onNotVisible.bind((a=>{this.app.fire("zappar:visible",!1)})),!this["Target Image"])throw new Error("No target image found in entity assets");const a=this["Target Image"].resource;this.imageTracker.loadTarget(a)},zapparImageTracker.prototype.update=function(){const a=this["Target Upright"]?90:0;this.imageTracker.visible.forEach((e=>{const{cameraPoseMatrix:r}=this.Camera,t=Array.from(e.pose(r.data,this.Camera.mirror)),i=(new pc.Mat4).set(t);this.entity.setEulerAngles(i.getEulerAngles().x+a,i.getEulerAngles().y,i.getEulerAngles().z),this.entity.setPosition(i.getTranslation())}))};const ZapparFaceTracker=pc.createScript("zapparFaceTracker");ZapparFaceTracker.attributes.add("Max Faces",{type:"number",default:1,description:"The maximum number of faces the tracker will look for"}),ZapparFaceTracker.attributes.add("Target Upright",{type:"boolean",default:!0,description:"Offset rotations for upright targets"}),ZapparFaceTracker.attributes.add("Zappar Camera",{type:"entity",description:"Zappar Camera (Drag from hierarchy)"}),ZapparFaceTracker.prototype.initialize=function(){if(!this["Zappar Camera"])throw new Error("Zappar Camera attribute undefined - Please link camera entity to attribute.");this.Camera=this["Zappar Camera"].script.zapparCamera,this.faceTracker=new Zappar.FaceTracker(this.Camera.pipeline),this.faceTracker.loadDefaultModel().then((()=>{console.log("face tracking model loaded")})),this.faceTracker.onNewAnchor.bind((a=>{console.log("New anchor has appeared:",a.id)})),this.faceTracker.onVisible.bind((a=>{console.log("Anchor is visible:",a.id)})),this.faceTracker.onNotVisible.bind((a=>{console.log("Anchor is not visible:",a.id)})),this.faceTracker.maxFaces=this["Max Faces"]},ZapparFaceTracker.prototype.update=function(){const{cameraPoseMatrix:a}=this.Camera,e=this["Target Upright"]?90:0;this.faceTracker.visible.forEach((r=>{const t=Array.from(r.pose(a.data,this.Camera.mirror)),i=(new pc.Mat4).set(t);this.entity.setEulerAngles(i.getEulerAngles().x+e,i.getEulerAngles().y,i.getEulerAngles().z),this.entity.setPosition(i.getTranslation())}))};const zapparInstantTracker=pc.createScript("zapparInstantTracker");zapparInstantTracker.attributes.add("Placement Button",{type:"entity",description:"Button which locks tracking state"}),zapparInstantTracker.attributes.add("Anchor Camera Offset",{type:"number",default:[0,0,-5],array:!0,description:"Offset the target by this vector while its camera anchored"}),zapparInstantTracker.attributes.add("Zappar Camera",{type:"entity",description:"Zappar Camera (Drag from hierarchy)"}),zapparInstantTracker.prototype.initialize=function(){if(!this["Zappar Camera"])throw new Error("Zappar Camera attribute undefined - Please link camera entity to attribute.");this.Camera=this["Zappar Camera"].script.zapparCamera,this.pipeline=this.Camera.pipeline;const t=this["Placement Button"];if(!t||!t.element)throw new Error("No placement button attached to instant tracker.");const placed=()=>{this.hasPlaced=!0,t.enabled=!1};t.element.on("mousedown",placed,this),t.element.on("touchstart",placed,this),this.instantTracker=new Zappar.InstantWorldTracker(this.pipeline)},zapparInstantTracker.prototype.update=function(){const t=this["Anchor Camera Offset"];this.hasPlaced||this.instantTracker.setAnchorPoseFromCameraOffset(...t);const{cameraPoseMatrix:a}=this.Camera,{anchor:e}=this.instantTracker,r=Array.from(e.pose(a.data,this.Camera.mirror)),n=(new pc.Mat4).set(r);this.entity.setEulerAngles(n.getEulerAngles().x,n.getEulerAngles().y,n.getEulerAngles().z),this.entity.setPosition(n.getTranslation())};const ZapparFaceLandmark=pc.createScript("zapparFaceLandmark");ZapparFaceLandmark.attributes.add("Landmark Target",{type:"string",enum:[{"Eye (Left)":"EYE_LEFT"},{"Eye (Right)":"EYE_RIGHT"},{"Ear (Left)":"EAR_LEFT"},{"Ear (Right)":"EAR_RIGHT"},{"Nose (Bridge)":"NOSE_BRIDGE"},{"Nose (Tip)":"NOSE_TIP"},{"Nose (Base)":"NOSE_BASE"},{"Lip (Top)":"LIP_TOP"},{"Lip (Bottom)":"LIP_BOTTOM"},{"Mouth (Center)":"MOUTH_CENTER"},{Chin:"CHIN"},{"Eyebrow (Left)":"EYEBROW_LEFT"},{"Eyebrow (Right)":"EYEBROW_RIGHT"}],default:"none",description:"Which face feature the landmark should track to"}),ZapparFaceLandmark.attributes.add("Face Tracker",{type:"entity",description:"Face Tracker (Drag from hierarchy)"}),ZapparFaceLandmark.attributes.add("Zappar Camera",{type:"entity",description:"Zappar Camera (Drag from hierarchy)"}),ZapparFaceLandmark.prototype.initialize=function(){const a=Zappar.FaceLandmarkName[this["Landmark Target"]];this.faceLandmark=new Zappar.FaceLandmark(a)},ZapparFaceLandmark.prototype.update=function(){if(!this["Zappar Camera"])throw new Error("Zappar Camera attribute undefined - Please link camera entity to attribute.");if(!this["Face Tracker"])throw new Error("Face Tracker attribute undefined - Please link face tracker entity to attribute.");const{faceTracker:a}=this["Face Tracker"].script.zapparFaceTracker,e=this["Zappar Camera"].script.zapparCamera,{pipeline:r}=e,t=e["Camera Pose"],i="poses"===e["Mirror Mode"];let n=r.cameraPoseDefault();switch(t){case"attitude":n=r.cameraPoseWithAttitude(i);break;case"anchor":{const e=a.anchors.values().next().value;e&&(n=r.cameraPoseWithOrigin(e.poseCameraRelative(i)));break}}a.visible.forEach((a=>{const e=(new pc.Mat4).set(Array.from(a.pose(n,i)));this.faceLandmark.updateFromFaceAnchor(a,i);const r=e.mul((new pc.Mat4).set(Array.from(this.faceLandmark.pose)));this.entity.setEulerAngles(r.getEulerAngles().x,r.getEulerAngles().y,r.getEulerAngles().z),this.entity.setPosition(r.getTranslation())}))};const ZapparFaceMesh=pc.createScript("zapparFaceMesh");ZapparFaceMesh.attributes.add("Face Tracker",{type:"entity",description:"Face Tracker (Drag from hierarchy)"}),ZapparFaceMesh.attributes.add("Zappar Camera",{type:"entity",description:"Zappar Camera (Drag from hierarchy)"}),ZapparFaceMesh.attributes.add("Fill mouth",{type:"boolean",default:!1,description:"Mesh fills mouth"}),ZapparFaceMesh.attributes.add("Fill eye (left)",{type:"boolean",default:!1,description:"Mesh fills eye"}),ZapparFaceMesh.attributes.add("Fill eye (right)",{type:"boolean",default:!1,description:"Mesh fills eye"}),ZapparFaceMesh.attributes.add("Mask",{type:"boolean",default:!1,description:"Occlude depth, do not render colors"}),ZapparFaceMesh.attributes.add("Full Head",{type:"boolean",default:!1,description:"Use full head mesh?"}),ZapparFaceMesh.attributes.add("material",{type:"asset",assetType:"material",description:"The material that the mesh uses"}),ZapparFaceMesh.prototype.initialize=function(){if(!this["Zappar Camera"])throw new Error("Zappar Camera attribute undefined - Please link camera entity to attribute.");if(!this["Face Tracker"])throw new Error("Face Tracker attribute undefined - Please link face tracker entity to attribute.");this.ZfaceMesh=new Zappar.FaceMesh;(this["Full Head"]?this.ZfaceMesh.loadDefaultFullHeadSimplified(this["Fill mouth"],this["Fill eye (left)"],this["Fill eye (right)"]):this.ZfaceMesh.loadDefaultFace(this["Fill mouth"],this["Fill eye (left)"],this["Fill eye (right)"])).then((()=>{const e=new pc.GraphNode,t=new pc.Model;t.graph=e;const a=pc.createMesh(this.app.graphicsDevice,Array.from(this.ZfaceMesh.vertices),{normals:Array.from(this.ZfaceMesh.normals),uvs:Array.from(this.ZfaceMesh.uvs)});let s;if(this.entity.removeComponent("model"),this.entity.addComponent("model"),this.Mask){let e=this.app.assets.find("Occluder");e?(s=e.resource,s.depthTest=!0,s.depthWrite=!0,s.blueWrite=!1,s.redWrite=!1,s.greenWrite=!1,s.alphaWrite=!1):(s=this.material.resource,console.warn('Zappar: Missing "Occluder material'))}else s=this.material.resource;const r=new pc.MeshInstance(a,s,e);t.meshInstances.push(r),this.entity.model&&(this.entity.model.model=t),this.entity.rotateLocal(0,180,0)})),this.faceTracker=this["Face Tracker"].script.zapparFaceTracker.faceTracker,this.Camera=this["Zappar Camera"].script.zapparCamera},ZapparFaceMesh.prototype.update=function(){this.faceTracker.visible.forEach((e=>{if(this.ZfaceMesh.updateFromFaceAnchor(e),this.entity.model&&this.entity.model.meshInstances[0]){const e=this.entity.model.meshInstances[0].mesh;e.setPositions(this.ZfaceMesh.vertices),e.setUvs(0,this.ZfaceMesh.uvs),e.setIndices(this.ZfaceMesh.indices),e.setNormals(this.ZfaceMesh.normals),e.update()}}))};const zapparBrowserUtil=pc.createScript("zapparBrowserUtil");zapparBrowserUtil.attributes.add("Mobile Only",{type:"boolean",default:!1,description:"Redirect users to mobile"}),zapparBrowserUtil.attributes.add("Compatibility Check",{type:"boolean",default:!1,description:"Perform compatability checks"}),zapparBrowserUtil.prototype.initialize=function(){this["Compatibility Check"]&&Zappar.browserIncompatible()&&(Zappar.browserIncompatibleUI(),this.app.autoRender=!1),this["Mobile Only"]&&(MobileOnly.isMobile()||(MobileOnly.showUI(),this.app.autoRender=!1))};var AnimationController=pc.createScript("animationController");AnimationController.prototype.initialize=function(){this.animation=this.entity.animation,this.allowedToHit=!1,this.animations={down:"Down.glb",up:"Up.glb",idle:"Idle.glb"},this.playing=!1,this.hideMoles(),this.app.on("game:start",(()=>{this.playing=!0})),this.app.on("game:end",(()=>{this.allowedToHit=!1,this.playing=!1,this.down(!1)})),this.eventEmitted=!1,this.animation.on("finished",(i=>{switch(i){case this.animations.down:this.up();break;case this.animations.up:this.idle();break;case this.animations.idle:this.down(!1)}})),this.respawnTime=1e4,this.idleTime=5e3,this.app.on("game:level",(i=>{this.respawnTime=i.respawnTime,this.idleTime=i.idleTime}))},AnimationController.prototype.hideMoles=function(){this.animation.play(this.animations.down),this.currentAnimation=this.animations.down,this.animation.currentTime=this.animation.duration-.05},AnimationController.prototype.down=function(i=!0){this.currentAnimation!==this.animations.down&&(i&&this.entity.children[0].sprite.play("explode"),this.animation.play(this.animations.down,.1),this.animation.speed=2,this.currentAnimation=this.animations.down,this.eventEmitted=!1,setTimeout((()=>{this.app.fire("game:sfx_descend"),this.allowedToHit=!1}),400))};const between=(i,t)=>Math.floor(Math.random()*(t-i+1))+i;AnimationController.prototype.up=function(){this.animation.speed=1,setTimeout((()=>{this.playing&&(this.allowedToHit=!0,this.animation.play(this.animations.up),this.currentAnimation=this.animations.up,this.eventEmitted=!1,this.app.fire("game:sfx_ascent"),setTimeout((()=>{this.down(!1)}),between(300,this.idleTime)))}),between(300,this.respawnTime))},AnimationController.prototype.idle=function(){this.animation.speed=1,this.animation.play(this.animations.idle),this.currentAnimation=this.animations.idle,this.eventEmitted=!1},AnimationController.prototype.update=function(i){this.timer+=i,this.playing?this.animation.currentTime!=this.animation.duration||this.eventEmitted||(this.eventEmitted=!0,this.animation.fire("finished",this.currentAnimation)):this.timer=0};var PickerRaycast=pc.createScript("pickerRaycast");PickerRaycast.prototype.initialize=function(){this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onClick,this);const t=this.app.touch;t&&(console.log("touch supported"),t.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this)),this.playing=!1,this.app.on("game:end",(()=>{this.playing=!1})),this.app.on("game:start",(()=>{this.playing=!0}))},PickerRaycast.prototype.updateFromScreen=function(t){const e=this.entity.camera.screenToWorld(t.x,t.y,this.entity.camera.nearClip),i=this.entity.camera.screenToWorld(t.x,t.y,this.entity.camera.farClip),a=this.app.systems.rigidbody.raycastFirst(e,i);this.playing&&null!==a&&(this.app.fire("game:picked_entity",a),a.entity.script.animationController.down())},PickerRaycast.prototype.onClick=function(t){this.updateFromScreen(t),t.event.preventDefault()},PickerRaycast.prototype.onTouchStart=function(t){this.updateFromScreen(t.touches[0]),t.event.preventDefault()};var Score=pc.createScript("score");Score.prototype.initialize=function(){let e=0;this.app.on("game:end",(()=>{e=0})),this.app.on("game:picked_entity",(i=>{const t=i.entity.script.animationController;t.allowedToHit?(t.allowedToHit=!1,e++,this.app.fire("game:sfx_hit")):(this.app.fire("game:sfx_miss"),e=0===e?0:--e),this.app.fire("game:score",e)}))};var Uicontroller=pc.createScript("uicontroller");Uicontroller.attributes.add("ScoreText",{type:"entity"}),Uicontroller.attributes.add("Instructions",{type:"entity"}),Uicontroller.attributes.add("InstructionsText",{type:"entity"}),Uicontroller.attributes.add("ContinueButton",{type:"entity"}),Uicontroller.attributes.add("GameController",{type:"entity"}),Uicontroller.attributes.add("Timer",{type:"entity"}),Uicontroller.attributes.add("TapToContinueText",{type:"entity"}),Uicontroller.attributes.add("ARInstructions",{type:"entity"}),Uicontroller.attributes.add("Level",{type:"entity"}),Uicontroller.prototype.initialize=function(){this.score=0,this.ScoreText.element.enabled=!1,this.Timer.element.enabled=!1,this.app.on("game:start",(()=>{this.ScoreText.element.enabled=!0,this.Timer.element.enabled=!0})),this.app.on("game:end",(()=>{this.TapToContinueText.element.text="(tap to retry)",this.InstructionsText.element.text=`\nYOU SCORED ${this.score}!\n\n\nTap on the moles\nwhen they appear to scare them away!\n`,this.ScoreText.element.enabled=!0,this.Timer.element.enabled=!1,this.ScoreText.element.enabled=!1,this.Instructions.enabled=!0,this.score=0,setTimeout((()=>{this.ContinueButton.element.enabled=!0,this.TapToContinueText.element.enabled=!0}),1500)})),this.app.on("game:score",(t=>{this.ScoreText.element.text=`SCORE:${t}`,this.score=t})),this.Level.enabled=!1,this.app.on("zappar:visible",(t=>{this.targetVisible=t,this.ARInstructions.enabled=!t,this.Level.enabled=t}));const onTap=()=>{this.targetVisible&&(this.ContinueButton.element.enabled=!1,this.TapToContinueText.element.enabled=!1,this.Instructions.enabled=!1,setTimeout((()=>{this.app.fire("game:start")}),500))};this.ContinueButton.element.on("mousedown",onTap,this),this.ContinueButton.element.on("touchstart",onTap,this)},Uicontroller.prototype.update=function(t){const e=this.GameController.script.timer.getRemainder();this.Timer.element.text=`${e}s`};var SoundController=pc.createScript("soundController");SoundController.prototype.initialize=function(){this.app.on("game:sfx_hit",(()=>{this.entity.sound.play("hit")})),this.app.on("game:sfx_miss",(()=>{this.entity.sound.play("miss")})),this.app.on("game:sfx_ascent",(()=>{this.entity.sound.play("ascent")})),this.app.on("game:sfx_descend",(()=>{this.entity.sound.play("descend")}))};var WindEffect=pc.createScript("windEffect");WindEffect.attributes.add("Resistance",{type:"number",default:100,description:"Resistance"}),WindEffect.prototype.initialize=function(){this.dx=0},WindEffect.prototype.update=function(t){this.dx+=.01+t;const e=Math.sin(this.dx)/this.Resistance,i=this.entity.getLocalEulerAngles();this.entity.setLocalEulerAngles(i.x+e,i.y+e,i.z+e)};let FollowPath=pc.createScript("followPath");FollowPath.attributes.add("pathRoot",{type:"entity",title:"Path Root"}),FollowPath.attributes.add("duration",{type:"number",default:10,title:"Duration Secs"}),FollowPath.attributes.add("startTime",{type:"number",default:0,title:"Start Time (Secs)",description:"Start the path from a specific point in time"}),FollowPath.prototype.initialize=function(){this.createPath(),this.on("attr:pathRoot",(function(t,i){t&&(this.createPath(),this.time=0)})),this.on("attr:time",(function(t,i){this.time=pc.math.clamp(this.startTime,0,this.duration)})),this.time=pc.math.clamp(this.startTime,0,this.duration),this.lookAt=new pc.Vec3,this.up=new pc.Vec3,this.flyingThrough=!0},FollowPath.prototype.update=function(t){let i;this.flyingThrough?(this.time+=t,this.time>this.duration&&(this.time-=this.duration),i=this.time/this.duration):i=this.pathSlider.value/this.pathSlider.max,this.entity.setPosition(this.px.value(i),this.py.value(i),this.pz.value(i)),this.lookAt.set(this.tx.value(i),this.ty.value(i),this.tz.value(i)),this.up.set(this.ux.value(i),this.uy.value(i),this.uz.value(i)),this.entity.lookAt(this.lookAt,this.up)},FollowPath.prototype.createPath=function(){let t=pc.CURVE_CARDINAL;this.px=new pc.Curve,this.px.type=t,this.py=new pc.Curve,this.py.type=t,this.pz=new pc.Curve,this.pz.type=t,this.tx=new pc.Curve,this.tx.type=t,this.ty=new pc.Curve,this.ty.type=t,this.tz=new pc.Curve,this.tz.type=t,this.ux=new pc.Curve,this.ux.type=t,this.uy=new pc.Curve,this.uy.type=t,this.uz=new pc.Curve,this.uz.type=t;let e=this.pathRoot.children,h=0,s=[],a=new pc.Vec3;for(s.push(0),i=1;i<e.length;i++){let t=e[i-1],o=e[i];a.sub2(t.getPosition(),o.getPosition()),h+=a.length(),s.push(h)}for(i=0;i<e.length;i++){let t=s[i]/h,a=e[i],o=a.getPosition();this.px.add(t,o.x),this.py.add(t,o.y),this.pz.add(t,o.z);let p=o.clone().add(a.forward);this.tx.add(t,p.x),this.ty.add(t,p.y),this.tz.add(t,p.z);let u=a.up;this.ux.add(t,u.x),this.uy.add(t,u.y),this.uz.add(t,u.z)}};var MoveLeftRight=pc.createScript("moveLeftRight");MoveLeftRight.attributes.add("clouds",{type:"entity",array:!0,default:["","","",""],title:"Number of clouds"}),MoveLeftRight.attributes.add("min_x",{type:"number",default:-.85}),MoveLeftRight.attributes.add("max_x",{type:"number",default:3.7,description:"Resistance"}),MoveLeftRight.attributes.add("speed",{type:"number",default:10}),MoveLeftRight.prototype.initialize=function(){},MoveLeftRight.prototype.normalize=function(t,e,i){let o=(t-e)/(i-e);return o-=.5,o=.5-Math.abs(o),o*=2,o},MoveLeftRight.prototype.update=function(t){let e=0;for(const i of this.clouds){e++;let o=e/10;const a=i.getLocalPosition();a.x<this.min_x?(a.x=this.max_x,i.setLocalPosition(a)):(a.x-=this.speed*o*t,i.setLocalPosition(a));let s=this.normalize(a.x,this.min_x,this.max_x);for(let t of i.model.meshInstances)t.setParameter("material_opacity",s)}};var Timer=pc.createScript("timer");Timer.attributes.add("GameLength",{type:"number",default:30}),Timer.prototype.initialize=function(){this.levels={easy:{respawnTime:1e4,idleTime:6e3},medium:{respawnTime:6e3,idleTime:4e3},hard:{respawnTime:3e3,idleTime:2500}},this.playing=!1,this.timer=0,this.app.on("game:start",(()=>{this.playing=!0})),this.app.on("game:end",(()=>{this.playing=!1}))},Timer.prototype.update=function(e){this.playing?(this.timer>35?this.app.fire("game:level",this.levels.hard):this.timer>15?this.app.fire("game:level",this.levels.medium):this.app.fire("game:level",this.levels.easy),this.timer+=e,this.timer>this.GameLength&&this.app.fire("game:end")):this.timer=0},Timer.prototype.getRemainder=function(){const e=this.GameLength-this.timer;return(e>0?e:0).toFixed(0)};var Videotexture=pc.createScript("videotexture");Videotexture.attributes.add("materials",{type:"asset",assetType:"material",array:!0}),Videotexture.attributes.add("videoAsset",{type:"asset",assetType:"audio"}),Videotexture.prototype.initialize=function(){var e=this.app,t=new pc.Texture(e.graphicsDevice,{format:pc.PIXELFORMAT_R5_G6_B5,autoMipmap:!1});t.minFilter=pc.FILTER_LINEAR,t.magFilter=pc.FILTER_LINEAR,t.addressU=pc.ADDRESS_CLAMP_TO_EDGE,t.addressV=pc.ADDRESS_CLAMP_TO_EDGE;var a=document.createElement("video");a.muted=!0,a.playsInline=!0,a.addEventListener("canplay",(function(e){t.setSource(a)})),a.src=this.videoAsset.getFileUrl(),a.crossOrigin="anonymous",a.loop=!0,a.play().catch((e=>{console.warn("Autoplay blocked:",e)}));for(var i=0;i<this.materials.length;i++){var s=this.materials[i].resource;s.emissiveMap=t,s.useEmissiveMap=!0,s.update()}this.videoTexture=t,a.play().catch((e=>{console.log("Autoplay may be blocked initially",e)})),this.app.touch.once(pc.EVENT_MOUSEDOWN,(function(){a.muted=!1,a.play()})),this.upload=!0},Videotexture.prototype.update=function(e){this.upload=!this.upload,this.upload&&this.videoTexture.upload()};